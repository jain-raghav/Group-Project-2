---
title: "Dataset Exploration"
author: "Malik Abbasi, Raghav, Himansu, Ari"
date: "11/2/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Data Cleaning and Organization
```{r}
cdata <- read.csv("WA_Fn-UseC_-Telco-Customer-Churn.csv", stringsAsFactors = TRUE)

#Removes rows with any NA values -- Should not affect results as there is a total of 7500+ rows of data and only 11 rows are removed
cdata <- na.omit(cdata)

#Removing CustomerID from dataset as it is not predictive
cdata$customerID <- NULL

#replace "no phone/internet service" with no to limit numbers of factors
cdata$OnlineSecurity <- as.factor(ifelse(cdata$OnlineSecurity == "No internet service" | cdata$OnlineSecurity == "No", "No", "Yes"))
cdata$OnlineBackup <- as.factor(ifelse(cdata$OnlineBackup == "No internet service" | cdata$OnlineBackup == "No", "No", "Yes"))
cdata$DeviceProtection <- as.factor(ifelse(cdata$DeviceProtection == "No internet service" | cdata$DeviceProtection == "No", "No", "Yes"))
cdata$TechSupport <- as.factor(ifelse(cdata$TechSupport == "No internet service" | cdata$TechSupport == "No", "No", "Yes"))
cdata$StreamingTV <- as.factor(ifelse(cdata$StreamingTV == "No internet service" | cdata$StreamingTV == "No", "No", "Yes"))
cdata$StreamingMovies <- as.factor(ifelse(cdata$StreamingMovies == "No internet service" | cdata$StreamingMovies == "No", "No", "Yes"))
cdata$MultipleLines <- as.factor(ifelse(cdata$MultipleLines == "No phone service" | cdata$MultipleLines == "No", "No", "Yes"))

str(cdata)
summary(cdata)

###
###
cdataMatrix <- as.data.frame(model.matrix(~.-1,cdata))

#Normalize the data
normalize <- function(x) {
  return ((x - min(x)) / (max(x) - min(x)))
}

# we are going to normalize everything 
cdataMatrix <- as.data.frame(lapply(cdataMatrix, normalize))
###
###

#creating test and train set
set.seed(12345)
test_set <- sample(1:nrow(cdata), round(nrow(cdata) / 2,0))

c_train <- cdata[-test_set, -match("Churn",names(cdata))]
c_test <- cdata[test_set, -match("Churn",names(cdata))]
c_trainMatrix <- cdataMatrix[-test_set, -match("ChurnYes",names(cdataMatrix))]
c_testMatrix <- cdataMatrix[test_set, -match("ChurnYes",names(cdataMatrix))]

#labels for the response variable 

c_train_labels <- cdata[-test_set, "Churn"]
c_test_labels <- cdata[test_set, "Churn"]
c_train_labelsMatrix <- cdataMatrix[-test_set, "ChurnYes"]
c_test_labelsMatrix <- cdataMatrix[test_set, "ChurnYes"]
```

### Logistic Regression Model
```{r}
#first model
c_train_labels_numeric <- ifelse(c_train_labels == "Yes", 1, 0)

glm1 <- glm(c_train_labels_numeric ~ ., data = c_train, family = binomial)
summary(glm1)
```

### KNN Model
```{r}
library(class)
library(caret)
knn1 <- knn(train = c_trainMatrix, test = c_testMatrix, cl = c_train_labelsMatrix, k = sqrt(nrow(c_trainMatrix)))

library(gmodels)
CrossTable(x = c_train_labelsMatrix, y = knn1, prop.chisq=FALSE)

confusionMatrix(knn1, as.factor(c_test_labelsMatrix))
```

### ANN Model
```{r}
library(neuralnet)
ann1 <- neuralnet(formula = c_train_labelsMatrix ~ . , data = c_trainMatrix)
plot(ann1)

ann_results <- compute(ann1, c_testMatrix)
predicted_y <- ann_results$net.result
predicted_y_dummy <- ifelse(predicted_y >= 0.5, 1, 0)

library(gmodels)
CrossTable(x = c_train_labelsMatrix, y = predicted_y_dummy, 
           prop.chisq=FALSE)

library(caret)
confusionMatrix(as.factor(c_test_labelsMatrix), as.factor(predicted_y_dummy))
```

### Preliminary Conclusions
#### Based on models above, are you on track to acheiving your objectives. Are the models helpful on your decision making? How do you need to improve the models?\

We believe that we are on track to our objectives. Know that we have baseline models working, we can continually improve them to get better data and info. 
For example with the log regression, there were many variables that seemed insignificant so we can definitely improve on that. Similarly, with the KNN and ANN we can try to get a better confusion matrix where we have less false positives and better prediction accuracy. 